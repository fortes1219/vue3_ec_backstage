var e=Object.defineProperty,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(a,s,l)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[s]=l,t=(e,t)=>{for(var d in t||(t={}))s.call(t,d)&&o(e,d,t[d]);if(a)for(var d of a(t))l.call(t,d)&&o(e,d,t[d]);return e};import{E as d,i as r,g as i,f as n,d as m,J as u,m as c}from"./element-plus.f1c40bb6.js";import{c as p}from"./callApi.ff108172.js";import{_ as f,P as b}from"./index.380865e7.js";import{a as h,n as v,o as y,p as _}from"./api.af76b8ff.js";import{f as g,o as V,h as w,j as F,a0 as k,I as P,a5 as A,r as x,p as C,y as U,a4 as D,_ as j,Y as E,V as I,aj as O,X as M,ak as z}from"./vendor.f296c83d.js";import{u as N}from"./user.65536355.js";const $=e=>{const a=e=>{Object.keys(e).map((s=>{if(e[s]===Object(e[s]))return a(e[s]),void(e[s]instanceof Array&&(e[s]=[]));{const a=e[s];switch(typeof a){case"string":e[s]="";break;case"number":e[s]=0;break;case"object":e[s]=a instanceof Array?[]:{};break;case"boolean":e[s]=!1;break;default:e[s]=void 0}}}))};a(e)},S=g({props:{data:{type:Object,default:()=>{}}}}),q={class:"admin-card"},L={class:"admin-card__content"},R={class:"admin-account"},J=F("hr",null,null,-1);const X=g({name:"AdminList",components:{AdminCard:f(S,[["render",function(e,a,s,l,o,t){return V(),w("div",q,[F("div",L,[F("p",null,"管理員ID："+k(e.data.ID),1),F("p",null,k(e.data.Email),1),F("p",R,k(e.data.Name),1),J,P(e.$slots,"default")])])}]])},setup(){const e=N(),a=A({tableData:[],mode:"",adminForm:{id:null,account:"",username:"",email:"",phone:"",password:"",checkPassword:""},permissions:{home:[],order:[],goods:[],member:[],admin:[]}}),s=x(),l=A({account:[{required:!0,message:"帳號不可留空",trigger:"blur"}],username:[{required:!0,message:"顯示名稱不可留空",trigger:"blur"}],password:[{required:!0,message:"密碼不可留空",trigger:"blur"}],checkPassword:[{validator:function(e,l,o){var t;""===l&&o(new Error("確認密碼欄位不可留空"));a.adminForm.checkPassword!==a.adminForm.password?o(new Error("密碼不一致，請再次確認")):(a.adminForm.password===a.adminForm.checkPassword&&(null==(t=s.value)||t.validateField("checkPassword",(()=>null))),o())},trigger:"blur"}]});const o=b,d=x(!1),r=x(!1),i=async()=>{await p(v,{},(e=>{a.tableData=e.data.Data}))},n=C((()=>e.$state.userStatus)),m=C((()=>e.$state.userPermissions)),u=async e=>{const s={MemberID:e.ID};let l={};await p(h,s,(e=>{l=e.data.Data.Permission}));const o=[];Object.keys(l).forEach((e=>{o.push({name:e,value:l[e].Activity})}));const t=Object.keys(a.permissions);for(let d in t){a.permissions[t[d]]=[];const e=new RegExp(`^${t[d]}`);o.forEach((s=>{e.test(s.name)&&a.permissions[t[d]].push(s)}))}},f=C((()=>{const e=JSON.parse(localStorage.getItem("userPermissions"));return{add:e.admin_manage_add.Activity,edit:e.admin_manage_edit.Activity,delete:e.admin_manage_del.Activity}})),g=U((async()=>{await i()}));return{state:a,formRules:l,adminAddForm:s,init:g,listName:o,getAdminList:i,userInfo:n,userPermissions:m,enable:f,createPermissionsList:u,openPermissions:async e=>{await u(e),a.adminForm.id=e.ID,a.adminForm.account=e.Account,a.adminForm.username=e.Name,a.adminForm.email=e.Email,a.adminForm.phone=e.Phone,d.value=!0},addMember:e=>{e&&e.validate((async e=>{if(!e)return c({type:"error",message:"表單內容錯誤，請重新檢查!"}),!1;{const e={Account:a.adminForm.account,Password:a.adminForm.password,Name:a.adminForm.username,Email:a.adminForm.email,Phone:a.adminForm.phone,Admin:!0};await p(y,e,(()=>{i(),c({type:"success",message:"成功新增管理員!"}),r.value=!1}))}}))},handleUpdatePermissions:async()=>{const s={},l=Object.keys(a.permissions);for(let e in l)a.permissions[l[e]].forEach((e=>{s[e.name]={Activity:e.value}}));const o={MemberID:a.adminForm.id,MemberPermission:t({},s)};await p(_,o,(e=>{c({type:"success",message:"已成功更新管理權限!"})})),await p(h,{MemberID:a.adminForm.id},(a=>{e.setUserPermissions(a.data.Data.Permission)}))},dialogPermissions:d,dialogAddMember:r,onCloseDialog:()=>{$(a.adminForm),$(a.permissions)}}}}),Y={class:"flx vertical grow flex_1","data-inset":"1rem"},B={class:"flx horizontal v_center"},G=z("新增管理員"),H={class:"flx horizontal wrap sp_top"},K={key:0,class:"flx horizontal v_center_end"},Q=z(" 權限設定 "),T=z(" 刪除 "),W={key:1,class:"notice"},Z={class:"dialog-footer"},ee=z("Cancel"),ae=z("Confirm"),se={class:"flx vertical"},le=F("h2",{class:"permissions-title"},"Dashboard",-1),oe={class:"flx wrap horizontal sp_bottom"},te=F("h2",{class:"permissions-title"},"訂單管理",-1),de={class:"flx wrap horizontal sp_bottom"},re=F("h2",{class:"permissions-title"},"商品管理",-1),ie={class:"flx wrap horizontal sp_bottom"},ne=F("h2",{class:"permissions-title"},"會員管理",-1),me={class:"flx wrap horizontal sp_bottom"},ue=F("h2",{class:"permissions-title"},"管理員列表",-1),ce={class:"flx wrap horizontal sp_bottom"},pe={class:"dialog-footer"},fe=z("Cancel"),be=z("Confirm");var he=f(X,[["render",function(e,a,s,l,o,t){const c=d,p=D("AdminCard"),f=r,b=i,h=n,v=m,y=u;return V(),w(I,null,[F("div",Y,[F("div",B,[j(c,{type:"primary",disabled:!e.enable.add,class:"deep_dark",round:"",icon:"Plus",onClick:a[0]||(a[0]=a=>e.dialogAddMember=!0)},{default:E((()=>[G])),_:1},8,["disabled"])]),F("div",H,[(V(!0),w(I,null,O(e.state.tableData,((a,s)=>(V(),M(p,{key:s,data:a},{default:E((()=>[1!==a.ID?(V(),w("div",K,[j(c,{type:"primary",disabled:!e.enable.edit,round:"",class:"deep_dark",icon:"Edit",size:"small",onClick:s=>e.openPermissions(a)},{default:E((()=>[Q])),_:2},1032,["disabled","onClick"]),j(c,{type:"primary",disabled:!e.enable.delete,round:"",class:"remove",icon:"Delete",size:"small"},{default:E((()=>[T])),_:1},8,["disabled"])])):(V(),w("p",W,"root角色不可修改"))])),_:2},1032,["data"])))),128))])]),j(v,{modelValue:e.dialogAddMember,"onUpdate:modelValue":a[9]||(a[9]=a=>e.dialogAddMember=a),width:"400px",title:"新增管理員",onClose:e.onCloseDialog},{footer:E((()=>[F("span",Z,[j(c,{plain:"",class:"cancel",onClick:a[7]||(a[7]=a=>e.dialogAddMember=!1)},{default:E((()=>[ee])),_:1}),j(c,{type:"primary",class:"confirm",onClick:a[8]||(a[8]=a=>e.addMember(e.adminAddForm))},{default:E((()=>[ae])),_:1})])])),default:E((()=>[j(h,{ref:"adminAddForm",model:e.state.adminForm,rules:e.formRules,"label-width":"100px"},{default:E((()=>[j(b,{label:"管理帳號:",prop:"account"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.account,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.adminForm.account=a),type:"text",placeholder:"管理員帳號"},null,8,["modelValue"])])),_:1}),j(b,{label:"顯示名稱:",prop:"username"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.username,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.adminForm.username=a),type:"text",placeholder:"顯示名稱"},null,8,["modelValue"])])),_:1}),j(b,{label:"管理密碼:",prop:"password"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.password,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.adminForm.password=a),type:"password",placeholder:"管理員密碼"},null,8,["modelValue"])])),_:1}),j(b,{label:"確認密碼:",prop:"checkPassword"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.checkPassword,"onUpdate:modelValue":a[4]||(a[4]=a=>e.state.adminForm.checkPassword=a),type:"password",placeholder:"請確認管理員密碼"},null,8,["modelValue"])])),_:1}),j(b,{label:"Email:",prop:"email"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.email,"onUpdate:modelValue":a[5]||(a[5]=a=>e.state.adminForm.email=a),type:"text",placeholder:"管理員電子信箱"},null,8,["modelValue"])])),_:1}),j(b,{label:"聯絡方式:",prop:"phone"},{default:E((()=>[j(f,{modelValue:e.state.adminForm.phone,"onUpdate:modelValue":a[6]||(a[6]=a=>e.state.adminForm.phone=a),type:"text",placeholder:"手機或電話"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),j(v,{modelValue:e.dialogPermissions,"onUpdate:modelValue":a[11]||(a[11]=a=>e.dialogPermissions=a),width:"570px",title:"管理權限設定",onClose:e.onCloseDialog},{footer:E((()=>[F("span",pe,[j(c,{plain:"",class:"cancel",onClick:a[10]||(a[10]=a=>e.dialogPermissions=!1)},{default:E((()=>[fe])),_:1}),j(c,{type:"primary",class:"confirm",onClick:e.handleUpdatePermissions},{default:E((()=>[be])),_:1},8,["onClick"])])])),default:E((()=>[j(h,{"label-width":"100px"},{default:E((()=>[j(b,{label:"管理帳號:"},{default:E((()=>[F("p",null,k(`${e.state.adminForm.account} (ID: ${e.state.adminForm.id})`),1)])),_:1}),j(b,{label:"權限設定:"},{default:E((()=>[F("div",se,[le,F("div",oe,[(V(!0),w(I,null,O(e.state.permissions.home,((a,s)=>(V(),w("div",{key:s,class:"sp_right"},[j(y,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},{default:E((()=>[z(k(e.listName[a.name]),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))]),te,F("div",de,[(V(!0),w(I,null,O(e.state.permissions.order,((a,s)=>(V(),w("div",{key:s,class:"sp_right"},[j(y,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},{default:E((()=>[z(k(e.listName[a.name]),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))]),re,F("div",ie,[(V(!0),w(I,null,O(e.state.permissions.goods,((a,s)=>(V(),w("div",{key:s,class:"sp_right"},[j(y,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},{default:E((()=>[z(k(e.listName[a.name]),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))]),ne,F("div",me,[(V(!0),w(I,null,O(e.state.permissions.member,((a,s)=>(V(),w("div",{key:s,class:"sp_right"},[j(y,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},{default:E((()=>[z(k(e.listName[a.name]),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))]),ue,F("div",ce,[(V(!0),w(I,null,O(e.state.permissions.admin,((a,s)=>(V(),w("div",{key:s,class:"sp_right"},[j(y,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e},{default:E((()=>[z(k(e.listName[a.name]),1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128))])])])),_:1})])),_:1})])),_:1},8,["modelValue","onClose"])],64)}]]);export{he as default};
