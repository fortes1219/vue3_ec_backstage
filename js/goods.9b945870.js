var e=Object.defineProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,o,l)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,t=(e,t)=>{for(var d in t||(t={}))o.call(t,d)&&s(e,d,t[d]);if(a)for(var d of a(t))l.call(t,d)&&s(e,d,t[d]);return e};import{m as d,n,E as r,p as i,z as c,d as p,u as m,g as u,i as g,f as y,A as f,r as h,s as I,h as w,I as _}from"./element-plus.74f8f849.js";import{_ as v}from"./index.a528fb69.js";import{f as b,o as C,h as G,I as D,b2 as S,r as k,a5 as P,p as x,y as V,a4 as F,j as T,Z as z,X as N,U,aj as R,ak as O,$ as L,W as j,T as A,R as $,aL as B}from"./vendor.121ac726.js";import{b as E,c as M,r as K,d as J,e as W,f as X,h as Z,i as q,j as H}from"./api.d563bb3a.js";const Q=b({name:"SearchField"}),Y={class:"search-field"};var ee=v(Q,[["render",function(e,a,o,l,s,t){return C(),G("div",Y,[D(e.$slots,"default")])}]]);const ae=S("goods",{state:()=>({typeList:[]}),getters:{},actions:{async getAllGoodsType(){const e=await E({});200===e.data.Code?this.typeList=e.data.Data:d({message:`API ERROR!! (${e.data.Code})`,type:"error"})}}}),oe=async(e,a,o)=>{const l=await e(a);200===l.data.Code?o(l):d({message:`API ERROR!! (${l.data.Code})`,type:"error"})},le=b({name:"Goods",components:{},setup(){const e=ae(),a=k(),o=P({searchParams:{goodsTypeSelected:0,goodsName:"",currentPage:1,pageSize:20},tableData:[],typeList:[],editMode:"add",imgFile:null,imgFileName:"",imgIdent:"",goodsImg:{}}),l=P({ID:null,Show:!0,GoodsTypeID:1,Name:"",SpecsAllowance:0,GoodsSpecs:[],UnitPrice:0,ImagesIdnet:"",Description:""}),s=k(!1),r=k(!1),i=k(""),c=k("");let p=t({},o.searchParams);const m=()=>{e.getAllGoodsType()},u=e=>JSON.parse(JSON.stringify(e)),g=x((()=>{const a=u(e.typeList);return a.unshift({ID:0,Name:"全部",Alias:""}),{origin:u(e.typeList),mix:a}})),y=(e=!0,a=!0)=>{const l=e?o.searchParams:p,s={Page:l.currentPage,Limit:l.pageSize,GoodsName:l.goodsName,GoodsType:l.goodsTypeSelected};a||(s.Page=1,o.searchParams.currentPage=1),oe(J,s,(e=>{o.tableData=e.data.Data,p=t({},l),o.tableData.forEach((e=>{o.goodsImg[e.ImagesIdnet]=[],I(e.ImagesIdnet)}))}))},f=x((()=>{let e="";return{add:()=>{e="新增商品"},edit:()=>{e="編輯商品"}}[o.editMode](),e})),h=e=>{e&&e.resetFields()},I=async e=>{oe(q,{Ident:e},(a=>{o.goodsImg[e]=a.data.Data}))},w=x((()=>t({},o.goodsImg))),_=V((async()=>{await m(),await y(!0,!1)}));return{state:o,goodsForm:l,goodsFormRef:a,newTypeName:i,newSpecName:c,parseObj:u,dialogGoods:s,dialogGoodsType:r,onPageChange:e=>{o.searchParams.currentPage=e,y(!1,!0)},onPageSizeChange:e=>{o.searchParams.pageSize=e,o.searchParams.currentPage=1,y(!1,!0)},openGoodsDialog:(e,a)=>{({add:()=>{o.editMode="add"},edit:()=>{o.editMode="edit";const e=u(a);Object.keys(l).forEach((a=>{l[a]=e[a]})),l.GoodsSpecs=l.GoodsSpecs.filter((e=>""!==e.Specs))}})[e](),s.value=!0},detectGoodsDialogMode:f,goodsTypeList:g,oldParams:p,handleSearch:y,getGoodsImg:I,handleUpdateGoods:()=>{const e=u(l);oe(W,e,(async()=>{await y(!1,!1),s.value=!1,d({type:"success",message:"已成功更新商品內容!"})}))},handleRemoveGoods:e=>{const a=`確定要刪除${e.Name}(ID: ${e.ID})?`,o=t({},e);n.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{oe(X,{ID:o.ID},(async()=>{await y(!1,!1),d({type:"success",message:"已成功刪除商品!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},openGoodsType:()=>{o.typeList=g.value.origin,r.value=!0},addNewGoodsType:()=>{oe(M,{Name:i.value},(async()=>{await m(),o.typeList=g.value.origin}))},addGoodsSpecs:()=>{l.GoodsSpecs.push({Specs:""})},removeGoodsSpecs:(e,a)=>{const o=l.GoodsSpecs.indexOf(e);o===a&&l.GoodsSpecs.splice(o,1)},handleUpdateGoodsType:()=>{const e=g.value.origin.filter((e=>e.ID>1)),a=u(e);oe(Z,{List:a},(async e=>{await m(),d({type:"success",message:"已成功更新商品分類!"}),o.typeList=g.value.origin}))},deleteGoodsType:e=>{const a=`確定要刪除${e.Name}(ID: ${e.ID})?`;n.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{oe(K,{ID:e.ID},(async e=>{await m(),d({type:"success",message:"已成功刪除商品分類!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},spacTagChange:e=>{},resetForm:h,resetGoodsForm:e=>{h(e),l.GoodsSpecs=[],l.Name},selectFile:async e=>{const a=e.target.files[0],l=a.size/1024;if(o.imgFile=a,o.imgFileName=a.name,l>250)return d({message:"檔案不可大於 250KB",type:"error"}),void(o.imgFileName="檔案不可大於 250KB，請重新選擇圖片")},getcurrentImgs:w,handleUpload:()=>{const e=u(localStorage.getItem("userInfo")).token,a=new FormData;a.append("Ident",l.ImagesIdnet),a.append("Img",o.imgFile);const s={method:"POST",headers:{token:e},body:a};null!==o.imgFile?fetch("/api/admin/image/c",s).then((e=>e.json())).then((e=>{o.goodsImg[l.ImagesIdnet].push(e.Data),d({type:"success",message:"已成功上傳圖片"})})).catch((()=>{d({type:"error",message:"API錯誤"})})):d({type:"error",message:"未選擇檔案"})},handleRemoveImg:e=>{const a=`確定要刪除【${e.Ident}】這張圖片嗎？(ID: ${e.ID})?`;n.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{const a={id:e.ID};oe(H,a,(async()=>{await H(a),await I(e.Ident),d({type:"success",message:"已成功刪除圖片!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},init:_}}}),se={class:"flx vertical grow flex_1","data-inset":"1rem"},te={class:"flx horizontal v_center space_between"},de={class:"flx horizontal v_center"},ne={class:"flx horizontal v_center_end"},re=O("重置"),ie=O("搜尋"),ce={class:"flx horizontal v_center space_between"},pe={class:"grid col-2"},me=O(" 分類管理 "),ue=O(" 新增商品 "),ge={class:"row vertical grow flex_1"},ye=["src","alt"],fe={class:"row horizontal v_center"},he=O(" 編輯商品 "),Ie=O(" 刪除 "),we=T("hr",null,null,-1),_e={class:"flx horizontal v_center","data-space-bottom":"1rem"},ve={class:"grid col-1","data-space-right":"0.5rem"},be=O("新增"),Ce={key:1},Ge=O(" 刪除 "),De={class:"dialog-footer"},Se=O("Cancel"),ke=O("Confirm"),Pe=T("hr",null,null,-1),xe=O("是"),Ve=O("否"),Fe={class:"w-200px"},Te={class:"flx horizontal v_center"},ze=T("span",{class:"sp_right"},"可選",-1),Ne={class:"w-50px sp_right"},Ue=T("span",{class:"sp_right"},"種",-1),Re=O(" 新增規格 "),Oe={class:"flx horizontal wrap","data-space-vertical":"1rem"},Le=["onUpdate:modelValue","onInput"],je={class:"w-80px"},Ae={class:"flx horizontal v_center sp_bottom"},$e={class:"upload-customize"},Be={class:"upload-btn"},Ee=O(" 選擇圖片 "),Me={class:"upload-file-name sp_left"},Ke={class:"flx horizontal v_center"},Je={class:"w-150px sp_right"},We=O("上傳圖片"),Xe={class:"goods-img-preview"},Ze={class:"img-container"},qe=["src"],He={class:"flx horizontal v_center flex_1"},Qe={class:"sp_left sp_right"},Ye={class:"dialog-footer"},ea=O("Cancel"),aa=O(" Reset "),oa=O("Confirm");var la=v(le,[["render",function(e,a,o,l,s,t){const d=_,n=m,v=u,b=g,D=r,S=y,k=ee,P=i,x=f,V=c,E=p,M=h,K=I,J=F("Close"),W=w,X=F("PictureFilled");return C(),G(U,null,[T("div",se,[z(k,null,{default:N((()=>[z(S,{"label-width":"100px",style:{width:"100%"}},{default:N((()=>[T("div",te,[T("div",de,[z(v,{label:"商品分類:"},{default:N((()=>[z(n,{modelValue:e.state.searchParams.goodsTypeSelected,"onUpdate:modelValue":a[0]||(a[0]=a=>e.state.searchParams.goodsTypeSelected=a)},{default:N((()=>[(C(!0),G(U,null,R(e.goodsTypeList.mix,((e,a)=>(C(),j(d,{key:a,label:e.Name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(v,{label:"商品名稱:"},{default:N((()=>[z(b,{modelValue:e.state.searchParams.goodsName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParams.goodsName=a),type:"text",placeholder:"請輸入商品名稱"},null,8,["modelValue"])])),_:1})]),T("div",ne,[z(D,{class:"reset",plain:""},{default:N((()=>[re])),_:1}),z(D,{class:"search",plain:"",icon:"Search",onClick:a[2]||(a[2]=a=>e.handleSearch(!0,!1))},{default:N((()=>[ie])),_:1})])])])),_:1})])),_:1}),T("div",ce,[z(P,{currentPage:e.state.searchParams.currentPage,"onUpdate:currentPage":a[3]||(a[3]=a=>e.state.searchParams.currentPage=a),"page-size":e.state.searchParams.pageSize,"onUpdate:page-size":a[4]||(a[4]=a=>e.state.searchParams.pageSize=a),"page-sizes":[20,50,100],small:!1,background:!0,layout:"sizes, prev, pager, next",total:0,"data-space-vertical":"1rem",onSizeChange:e.onPageSizeChange,onCurrentChange:e.onPageChange},null,8,["currentPage","page-size","onSizeChange","onCurrentChange"]),T("div",pe,[z(D,{type:"primary",size:"small",round:"",class:"dark",icon:"Collection",onClick:e.openGoodsType},{default:N((()=>[me])),_:1},8,["onClick"]),z(D,{type:"primary",size:"small",round:"",class:"dark",icon:"CirclePlus",onClick:a[5]||(a[5]=a=>e.openGoodsDialog("add"))},{default:N((()=>[ue])),_:1})])]),T("div",ge,[z(V,{data:e.state.tableData,style:{width:"100%",height:"100%"}},{default:N((()=>[z(x,{label:"ID",prop:"ID",sortable:"",align:"center",width:"100"}),z(x,{label:"商品名稱",prop:"Name",align:"center"}),z(x,{label:"商品分類",prop:"GoodsType.Name",align:"center"}),z(x,{label:"商品圖片",prop:"ImagesIdnet",align:"center",width:"120"},{default:N((a=>{var o;return[T("img",{src:null==(o=e.getcurrentImgs[a.row.ImagesIdnet][0])?void 0:o.Url,alt:a.row.Name},null,8,ye)]})),_:1}),z(x,{label:"前台顯示",prop:"Show",align:"center",width:"120"},{default:N((e=>[O(L(e.row.Show?"是":"否"),1)])),_:1}),z(x,{label:"操作",align:"center",width:"200"},{default:N((a=>[T("div",fe,[z(D,{type:"primary",size:"small",round:"",class:"dark",icon:"Edit",onClick:o=>e.openGoodsDialog("edit",a.row)},{default:N((()=>[he])),_:2},1032,["onClick"]),z(D,{type:"primary",size:"small",round:"",class:"remove",icon:"Delete",onClick:o=>e.handleRemoveGoods(a.row)},{default:N((()=>[Ie])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])])]),z(E,{modelValue:e.dialogGoodsType,"onUpdate:modelValue":a[8]||(a[8]=a=>e.dialogGoodsType=a),width:"570px",title:"分類管理"},{footer:N((()=>[T("span",De,[z(D,{plain:"",class:"cancel",onClick:a[7]||(a[7]=a=>e.dialogGoodsType=!1)},{default:N((()=>[Se])),_:1}),z(D,{type:"primary",class:"confirm",onClick:e.handleUpdateGoodsType},{default:N((()=>[ke])),_:1},8,["onClick"])])])),default:N((()=>[we,T("div",_e,[T("div",ve,[z(b,{modelValue:e.newTypeName,"onUpdate:modelValue":a[6]||(a[6]=a=>e.newTypeName=a),type:"text",placeholder:"分類名稱"},null,8,["modelValue"])]),z(D,{type:"primary",class:"deep_dark",icon:"CirclePlus",onClick:e.addNewGoodsType},{default:N((()=>[be])),_:1},8,["onClick"])]),z(V,{data:e.goodsTypeList.origin,height:"300px",style:{width:"100%"},"default-sort":{prop:"ID",order:"descending"}},{default:N((()=>[z(x,{label:"ID",prop:"ID",sortable:"",align:"center",width:"100"}),z(x,{label:"分類名稱",prop:"Name",align:"center"},{default:N((e=>[e.row.ID>1?(C(),j(b,{key:0,modelValue:e.row.Name,"onUpdate:modelValue":a=>e.row.Name=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])):(C(),G("p",Ce,L(e.row.Name),1))])),_:1}),z(x,{label:"分類別名",align:"center"},{default:N((e=>[e.row.ID>1?(C(),j(b,{key:0,modelValue:e.row.Alias,"onUpdate:modelValue":a=>e.row.Alias=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])):A("",!0)])),_:1}),z(x,{label:"操作",align:"center",width:"200"},{default:N((a=>[a.row.ID>1?(C(),j(D,{key:0,type:"primary",size:"small",round:"",class:"remove",icon:"Delete",onClick:o=>e.deleteGoodsType(a.row)},{default:N((()=>[Ge])),_:2},1032,["onClick"])):A("",!0)])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),z(E,{modelValue:e.dialogGoods,"onUpdate:modelValue":a[19]||(a[19]=a=>e.dialogGoods=a),width:"600px","close-on-click-modal":!1,title:e.detectGoodsDialogMode,onClose:a[20]||(a[20]=a=>e.resetGoodsForm(e.goodsFormRef))},{footer:N((()=>[T("span",Ye,[z(D,{plain:"",class:"cancel",onClick:a[17]||(a[17]=a=>e.dialogGoods=!1)},{default:N((()=>[ea])),_:1}),"edit"!==e.state.editMode?(C(),j(D,{key:0,plain:"",class:"cancel",onClick:a[18]||(a[18]=a=>e.resetGoodsForm(e.goodsFormRef))},{default:N((()=>[aa])),_:1})):A("",!0),z(D,{type:"primary",class:"confirm",onClick:e.handleUpdateGoods},{default:N((()=>[oa])),_:1},8,["onClick"])])])),default:N((()=>[Pe,z(S,{ref:"goodsFormRef",model:e.goodsForm,"label-width":"80px"},{default:N((()=>[z(v,{label:"前台顯示:",prop:"Show"},{default:N((()=>[z(K,{modelValue:e.goodsForm.Show,"onUpdate:modelValue":a[9]||(a[9]=a=>e.goodsForm.Show=a),size:"small"},{default:N((()=>[z(M,{label:!0},{default:N((()=>[xe])),_:1}),z(M,{label:!1},{default:N((()=>[Ve])),_:1})])),_:1},8,["modelValue"])])),_:1}),z(v,{label:"分類:",prop:"GoodsTypeID"},{default:N((()=>[z(n,{modelValue:e.goodsForm.GoodsTypeID,"onUpdate:modelValue":a[10]||(a[10]=a=>e.goodsForm.GoodsTypeID=a)},{default:N((()=>[(C(!0),G(U,null,R(e.goodsTypeList.origin,((e,a)=>(C(),j(d,{key:a,label:e.Name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(v,{label:"名稱:",prop:"Name"},{default:N((()=>[T("div",Fe,[z(b,{modelValue:e.goodsForm.Name,"onUpdate:modelValue":a[11]||(a[11]=a=>e.goodsForm.Name=a),type:"text",class:"col-1-4",placeholder:"商品名稱"},null,8,["modelValue"])])])),_:1}),z(v,{label:"商品規格:",prop:"SpecsAllowance"},{default:N((()=>[T("div",Te,[ze,T("div",Ne,[z(b,{modelValue:e.goodsForm.SpecsAllowance,"onUpdate:modelValue":a[12]||(a[12]=a=>e.goodsForm.SpecsAllowance=a),type:"text"},null,8,["modelValue"])]),Ue,z(D,{type:"primary",round:"",class:"deep_dark",icon:"CirclePlus",onClick:e.addGoodsSpecs},{default:N((()=>[Re])),_:1},8,["onClick"])]),T("div",Oe,[(C(!0),G(U,null,R(e.goodsForm.GoodsSpecs,((a,o)=>(C(),G("span",{key:o,class:"spec_tag"},[z(W,{onClick:l=>e.removeGoodsSpecs(a,o)},{default:N((()=>[z(J)])),_:2},1032,["onClick"]),T("span",null,L(a.Specs),1),$(T("input",{"onUpdate:modelValue":e=>a.Specs=e,type:"text",placeholder:"商品規格",onInput:a=>e.spacTagChange(o)},null,40,Le),[[B,a.Specs]])])))),128))])])),_:1}),z(v,{label:"金額:",prop:"UnitPrice"},{default:N((()=>[T("div",je,[z(b,{modelValue:e.goodsForm.UnitPrice,"onUpdate:modelValue":a[13]||(a[13]=a=>e.goodsForm.UnitPrice=a),type:"text",class:"col-1-3",placeholder:"商品單價"},null,8,["modelValue"])])])),_:1}),z(v,{label:"圖片上傳:",prop:"ImagesIdnet"},{default:N((()=>[T("div",Ae,[T("label",$e,[T("span",Be,[z(W,null,{default:N((()=>[z(X)])),_:1}),Ee]),T("input",{type:"file",onChange:a[14]||(a[14]=a=>e.selectFile(a))},null,32)]),T("span",Me,"選擇圖檔: "+L(e.state.imgFileName),1)]),T("div",Ke,[T("div",Je,[z(b,{modelValue:e.goodsForm.ImagesIdnet,"onUpdate:modelValue":a[15]||(a[15]=a=>e.goodsForm.ImagesIdnet=a),type:"text",placeholder:"圖片別名(Ident)"},null,8,["modelValue"])]),z(D,{type:"primary",class:"deep_dark",icon:"UploadFilled",onClick:e.handleUpload},{default:N((()=>[We])),_:1},8,["onClick"])]),T("div",Xe,[(C(!0),G(U,null,R(e.getcurrentImgs[e.goodsForm.ImagesIdnet],((a,o)=>(C(),G("div",{key:o,class:"img-preview__items"},[T("div",Ze,[T("img",{src:a.Url},null,8,qe)]),T("div",He,[T("p",Qe,"ID: "+L(a.ID),1),T("p",null,"Ident: "+L(a.Ident),1)]),z(W,{onClick:o=>e.handleRemoveImg(a)},{default:N((()=>[z(J)])),_:2},1032,["onClick"])])))),128))])])),_:1}),z(v,{label:"商品說明:",prop:"Description"},{default:N((()=>[z(b,{modelValue:e.goodsForm.Description,"onUpdate:modelValue":a[16]||(a[16]=a=>e.goodsForm.Description=a),type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"商品說明"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])],64)}]]);export{la as default};
