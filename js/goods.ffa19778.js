var e=Object.defineProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,o,l)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,t=(e,t)=>{for(var d in t||(t={}))o.call(t,d)&&s(e,d,t[d]);if(a)for(var d of a(t))l.call(t,d)&&s(e,d,t[d]);return e};import{m as d,I as n,t as r,g as i,i as c,E as p,f as m,o as u,z as g,y,d as f,q as h,r as I,h as w,G as _}from"./element-plus.f1c40bb6.js";import{_ as v}from"./index.37c11861.js";import{f as D,o as b,h as C,I as S,b2 as G,r as k,a5 as P,p as V,y as x,a4 as T,j as F,_ as U,Y as z,X as N,V as O,aj as j,ak as A,a0 as L,U as R,S as $,aL as M}from"./vendor.f296c83d.js";import{c as B,d as E,r as K,e as J,f as q,h as X,i as Y,j as H,k as Q,l as W,m as Z}from"./api.af76b8ff.js";import{c as ee}from"./callApi.ff108172.js";const ae=D({name:"SearchField"}),oe={class:"search-field"};var le=v(ae,[["render",function(e,a,o,l,s,t){return b(),C("div",oe,[S(e.$slots,"default")])}]]);const se=G("goods",{state:()=>({typeList:[]}),getters:{},actions:{async getAllGoodsType(){const e=await B({});200===e.data.Code?this.typeList=e.data.Data:d({message:`API ERROR!! (${e.data.Code})`,type:"error"})}}}),te=D({name:"Goods",components:{},setup(){const e=se(),a=k(),o=P({searchParams:{goodsTypeSelected:0,goodsName:"",currentPage:1,pageSize:20},tableData:[],typeList:[],editMode:"add",imgFile:null,imgFileName:"",imgIdent:"",goodsImg:{}}),l=P({ID:null,Show:!0,GoodsTypeID:1,Name:"",SpecsAllowance:0,GoodsSpecs:[],UnitPrice:0,ImagesIdnet:"",Description:""}),s=k(!1),n=k(!1),r=k(""),i=k("");let c=t({},o.searchParams);const p=()=>{e.getAllGoodsType()},m=e=>JSON.parse(JSON.stringify(e)),u=V((()=>{const a=m(e.typeList);return a.unshift({ID:0,Name:"全部",Alias:""}),{origin:m(e.typeList),mix:a}})),g=(e=!0,a=!0)=>{const l=e?o.searchParams:c,s={Page:l.currentPage,Limit:l.pageSize,GoodsName:l.goodsName,GoodsType:l.goodsTypeSelected};a||(s.Page=1,o.searchParams.currentPage=1),ee(q,s,(e=>{o.tableData=e.data.Data,c=t({},l),o.tableData.forEach((e=>{o.goodsImg[e.ImagesIdnet]=[],h(e.ImagesIdnet)}))}))},y=V((()=>{let e="";return{add:()=>{e="新增商品"},edit:()=>{e="編輯商品"}}[o.editMode](),e})),f=()=>{l.ID=null,l.Show=!0,l.GoodsTypeID=1,l.Name="",l.SpecsAllowance=0,l.GoodsSpecs=[],l.UnitPrice=0,l.ImagesIdnet="",l.Description=""},h=async e=>{ee(W,{Ident:e},(a=>{o.goodsImg[e]=a.data.Data}))},I=V((()=>t({},o.goodsImg))),w=x((async()=>{await p(),await g(!0,!1)}));return{state:o,goodsForm:l,goodsFormRef:a,newTypeName:r,newSpecName:i,parseObj:m,dialogGoods:s,dialogGoodsType:n,onPageChange:e=>{o.searchParams.currentPage=e,g(!1,!0)},onPageSizeChange:e=>{o.searchParams.pageSize=e,o.searchParams.currentPage=1,g(!1,!0)},openGoodsDialog:(e,a)=>{({add:()=>{o.editMode="add",f()},edit:()=>{o.editMode="edit";const e=m(a);Object.keys(l).forEach((a=>{l[a]=e[a]})),l.GoodsSpecs=l.GoodsSpecs.filter((e=>""!==e.Specs))}})[e](),s.value=!0},detectGoodsDialogMode:y,goodsTypeList:u,oldParams:c,handleSearch:g,getGoodsImg:h,handleUpdateGoods:(e=!1)=>{const a=m(l);e&&delete a.ID,a.SpecsAllowance=1*a.SpecsAllowance,a.UnitPrice=1*a.UnitPrice,ee(e?X:Y,a,(async()=>{await g(!1,!1),s.value=!1,d({type:"success",message:"已成功更新商品內容!"})}))},handleRemoveGoods:e=>{const a=`確定要刪除${e.Name}(ID: ${e.ID})?`,o=t({},e);_.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{ee(H,{ID:o.ID},(async()=>{await g(!1,!1),d({type:"success",message:"已成功刪除商品!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},openGoodsType:()=>{o.typeList=u.value.origin,n.value=!0},addNewGoodsType:()=>{ee(E,{Name:r.value},(async()=>{await p(),o.typeList=u.value.origin}))},addGoodsSpecs:()=>{l.GoodsSpecs.push({Specs:""})},removeGoodsSpecs:async(e,a)=>{const o=l.GoodsSpecs.indexOf(e);o===a&&l.GoodsSpecs.splice(o,1),await ee(J,{ID:e.ID},(()=>{d({message:`已移除 ${e.Specs} ID: ${e.ID}`,type:"success"})}))},handleUpdateGoodsType:()=>{const e=u.value.origin.filter((e=>e.ID>1)),a=m(e);ee(Q,{List:a},(async e=>{await p(),d({type:"success",message:"已成功更新商品分類!"}),o.typeList=u.value.origin}))},deleteGoodsType:e=>{const a=`確定要刪除${e.Name}(ID: ${e.ID})?`;_.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{ee(K,{ID:e.ID},(async e=>{await p(),d({type:"success",message:"已成功刪除商品分類!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},spacTagChange:e=>{},resetForm:e=>{e&&e.resetFields()},resetGoodsForm:f,selectFile:async e=>{const a=e.target.files[0],l=a.size/1024;if(o.imgFile=a,o.imgFileName=a.name,l>250)return d({message:"檔案不可大於 250KB",type:"error"}),void(o.imgFileName="檔案不可大於 250KB，請重新選擇圖片")},getcurrentImgs:I,handleUpload:()=>{const e=m(localStorage.getItem("userInfo")).token,a=new FormData;a.append("Ident",l.ImagesIdnet),a.append("Img",o.imgFile);const s={method:"POST",headers:{token:e},body:a};if(null===o.imgFile)return void d({type:"error",message:"未選擇檔案"});o.goodsImg.hasOwnProperty(l.ImagesIdnet)||(o.goodsImg[l.ImagesIdnet]=[]);fetch("https://nocodenolife.net/fortes//admin/image/c",s).then((e=>e.json())).then((e=>{o.goodsImg[l.ImagesIdnet].push(e.Data),d({type:"success",message:"已成功上傳圖片"})})).catch((()=>{d({type:"error",message:"API錯誤"})}))},handleRemoveImg:e=>{const a=`確定要刪除【${e.Ident}】這張圖片嗎？(ID: ${e.ID})?`;_.confirm(a,"提示訊息",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{const a={id:e.ID};ee(Z,a,(async()=>{await Z(a),await h(e.Ident),d({type:"success",message:"已成功刪除圖片!"})}))})).catch((()=>{d({type:"info",message:"已取消"})}))},init:w}}}),de={class:"flx vertical grow flex_1","data-inset":"1rem"},ne={class:"flx horizontal v_center space_between"},re={class:"flx horizontal v_center"},ie={class:"flx horizontal v_center_end"},ce=A("重置"),pe=A("搜尋"),me={class:"flx horizontal v_center space_between"},ue={class:"grid col-2"},ge=A(" 分類管理 "),ye=A(" 新增商品 "),fe={class:"row vertical grow flex_1"},he=["src","alt"],Ie={class:"row horizontal v_center"},we=A(" 編輯商品 "),_e=A(" 刪除 "),ve=F("hr",null,null,-1),De={class:"flx horizontal v_center","data-space-bottom":"1rem"},be={class:"grid col-1","data-space-right":"0.5rem"},Ce=A("新增"),Se={key:1},Ge=A(" 刪除 "),ke={class:"dialog-footer"},Pe=A("Cancel"),Ve=A("Confirm"),xe=F("hr",null,null,-1),Te=A("是"),Fe=A("否"),Ue={class:"w-200px"},ze={class:"flx horizontal v_center"},Ne=F("span",{class:"sp_right"},"可選",-1),Oe={class:"w-50px sp_right"},je=F("span",{class:"sp_right"},"種",-1),Ae=A(" 新增規格 "),Le={class:"flx horizontal wrap","data-space-vertical":"1rem"},Re=["onUpdate:modelValue","onInput"],$e={class:"w-80px"},Me={class:"flx horizontal v_center sp_bottom"},Be={class:"upload-customize"},Ee={class:"upload-btn"},Ke=A(" 選擇圖片 "),Je={class:"upload-file-name sp_left"},qe={class:"flx horizontal v_center"},Xe={class:"w-150px sp_right"},Ye=A("上傳圖片"),He={class:"goods-img-preview"},Qe={class:"img-container"},We=["src"],Ze={class:"flx horizontal v_center flex_1"},ea={class:"sp_left sp_right"},aa={class:"dialog-footer"},oa=A("Cancel"),la=A(" Reset "),sa=A(" Confirm ");var ta=v(te,[["render",function(e,a,o,l,s,t){const d=n,_=r,v=i,D=c,S=p,G=m,k=le,P=u,V=g,x=y,B=f,E=h,K=I,J=T("Close"),q=w,X=T("PictureFilled");return b(),C(O,null,[F("div",de,[U(k,null,{default:z((()=>[U(G,{"label-width":"100px",style:{width:"100%"}},{default:z((()=>[F("div",ne,[F("div",re,[U(v,{label:"商品分類:"},{default:z((()=>[U(_,{modelValue:e.state.searchParams.goodsTypeSelected,"onUpdate:modelValue":a[0]||(a[0]=a=>e.state.searchParams.goodsTypeSelected=a)},{default:z((()=>[(b(!0),C(O,null,j(e.goodsTypeList.mix,((e,a)=>(b(),N(d,{key:a,label:e.Name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),U(v,{label:"商品名稱:"},{default:z((()=>[U(D,{modelValue:e.state.searchParams.goodsName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParams.goodsName=a),type:"text",placeholder:"請輸入商品名稱"},null,8,["modelValue"])])),_:1})]),F("div",ie,[U(S,{class:"reset",plain:""},{default:z((()=>[ce])),_:1}),U(S,{class:"search",plain:"",icon:"Search",onClick:a[2]||(a[2]=a=>e.handleSearch(!0,!1))},{default:z((()=>[pe])),_:1})])])])),_:1})])),_:1}),F("div",me,[U(P,{currentPage:e.state.searchParams.currentPage,"onUpdate:currentPage":a[3]||(a[3]=a=>e.state.searchParams.currentPage=a),"page-size":e.state.searchParams.pageSize,"onUpdate:page-size":a[4]||(a[4]=a=>e.state.searchParams.pageSize=a),"page-sizes":[20,50,100],small:!1,background:!0,layout:"sizes, prev, pager, next",total:0,"data-space-vertical":"1rem",onSizeChange:e.onPageSizeChange,onCurrentChange:e.onPageChange},null,8,["currentPage","page-size","onSizeChange","onCurrentChange"]),F("div",ue,[U(S,{type:"primary",size:"small",round:"",class:"dark",icon:"Collection",onClick:e.openGoodsType},{default:z((()=>[ge])),_:1},8,["onClick"]),U(S,{type:"primary",size:"small",round:"",class:"dark",icon:"CirclePlus",onClick:a[5]||(a[5]=a=>e.openGoodsDialog("add"))},{default:z((()=>[ye])),_:1})])]),F("div",fe,[U(x,{data:e.state.tableData,"default-sort":{prop:"ID",order:"descending"},style:{width:"100%",height:"100%"}},{default:z((()=>[U(V,{label:"ID",prop:"ID",sortable:"",align:"center",width:"100"}),U(V,{label:"商品名稱",prop:"Name",align:"center"}),U(V,{label:"商品分類",prop:"GoodsType.Name",align:"center"}),U(V,{label:"商品圖片",prop:"ImagesIdnet",align:"center",width:"120"},{default:z((a=>{var o;return[F("img",{src:null==(o=e.getcurrentImgs[a.row.ImagesIdnet][0])?void 0:o.Url,alt:a.row.Name},null,8,he)]})),_:1}),U(V,{label:"前台顯示",prop:"Show",align:"center",width:"120"},{default:z((e=>[A(L(e.row.Show?"是":"否"),1)])),_:1}),U(V,{label:"操作",align:"center",width:"200"},{default:z((a=>[F("div",Ie,[U(S,{type:"primary",size:"small",round:"",class:"dark",icon:"Edit",onClick:o=>e.openGoodsDialog("edit",a.row)},{default:z((()=>[we])),_:2},1032,["onClick"]),U(S,{type:"primary",size:"small",round:"",class:"remove",icon:"Delete",onClick:o=>e.handleRemoveGoods(a.row)},{default:z((()=>[_e])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])])]),U(B,{modelValue:e.dialogGoodsType,"onUpdate:modelValue":a[8]||(a[8]=a=>e.dialogGoodsType=a),width:"570px",title:"分類管理"},{footer:z((()=>[F("span",ke,[U(S,{plain:"",class:"cancel",onClick:a[7]||(a[7]=a=>e.dialogGoodsType=!1)},{default:z((()=>[Pe])),_:1}),U(S,{type:"primary",class:"confirm",onClick:e.handleUpdateGoodsType},{default:z((()=>[Ve])),_:1},8,["onClick"])])])),default:z((()=>[ve,F("div",De,[F("div",be,[U(D,{modelValue:e.newTypeName,"onUpdate:modelValue":a[6]||(a[6]=a=>e.newTypeName=a),type:"text",placeholder:"分類名稱"},null,8,["modelValue"])]),U(S,{type:"primary",class:"deep_dark",icon:"CirclePlus",onClick:e.addNewGoodsType},{default:z((()=>[Ce])),_:1},8,["onClick"])]),U(x,{data:e.goodsTypeList.origin,height:"300px",style:{width:"100%"},"default-sort":{prop:"ID",order:"descending"}},{default:z((()=>[U(V,{label:"ID",prop:"ID",sortable:"",align:"center",width:"100"}),U(V,{label:"分類名稱",prop:"Name",align:"center"},{default:z((e=>[e.row.ID>1?(b(),N(D,{key:0,modelValue:e.row.Name,"onUpdate:modelValue":a=>e.row.Name=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])):(b(),C("p",Se,L(e.row.Name),1))])),_:1}),U(V,{label:"分類別名",align:"center"},{default:z((e=>[e.row.ID>1?(b(),N(D,{key:0,modelValue:e.row.Alias,"onUpdate:modelValue":a=>e.row.Alias=a,type:"text"},null,8,["modelValue","onUpdate:modelValue"])):R("",!0)])),_:1}),U(V,{label:"操作",align:"center",width:"200"},{default:z((a=>[a.row.ID>1?(b(),N(S,{key:0,type:"primary",size:"small",round:"",class:"remove",icon:"Delete",onClick:o=>e.deleteGoodsType(a.row)},{default:z((()=>[Ge])),_:2},1032,["onClick"])):R("",!0)])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),(b(),N(B,{key:`dialog-${e.state.editMode}`,modelValue:e.dialogGoods,"onUpdate:modelValue":a[19]||(a[19]=a=>e.dialogGoods=a),width:"600px","close-on-click-modal":!1,title:e.detectGoodsDialogMode,onClose:e.resetGoodsForm},{footer:z((()=>[F("span",aa,[U(S,{plain:"",class:"cancel",onClick:a[17]||(a[17]=a=>e.dialogGoods=!1)},{default:z((()=>[oa])),_:1}),"edit"!==e.state.editMode?(b(),N(S,{key:0,plain:"",class:"cancel",onClick:e.resetGoodsForm},{default:z((()=>[la])),_:1},8,["onClick"])):R("",!0),U(S,{type:"primary",class:"confirm",onClick:a[18]||(a[18]=a=>e.handleUpdateGoods("edit"!==e.state.editMode))},{default:z((()=>[sa])),_:1})])])),default:z((()=>[xe,U(G,{ref:"goodsFormRef",model:e.goodsForm,"label-width":"80px"},{default:z((()=>[U(v,{label:"前台顯示:",prop:"Show"},{default:z((()=>[U(K,{modelValue:e.goodsForm.Show,"onUpdate:modelValue":a[9]||(a[9]=a=>e.goodsForm.Show=a),size:"small"},{default:z((()=>[U(E,{label:!0},{default:z((()=>[Te])),_:1}),U(E,{label:!1},{default:z((()=>[Fe])),_:1})])),_:1},8,["modelValue"])])),_:1}),U(v,{label:"分類:",prop:"GoodsTypeID"},{default:z((()=>[U(_,{modelValue:e.goodsForm.GoodsTypeID,"onUpdate:modelValue":a[10]||(a[10]=a=>e.goodsForm.GoodsTypeID=a)},{default:z((()=>[(b(!0),C(O,null,j(e.goodsTypeList.origin,((e,a)=>(b(),N(d,{key:a,label:e.Name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),U(v,{label:"名稱:",prop:"Name"},{default:z((()=>[F("div",Ue,[U(D,{modelValue:e.goodsForm.Name,"onUpdate:modelValue":a[11]||(a[11]=a=>e.goodsForm.Name=a),type:"text",class:"col-1-4",placeholder:"商品名稱"},null,8,["modelValue"])])])),_:1}),U(v,{label:"商品規格:",prop:"SpecsAllowance"},{default:z((()=>[F("div",ze,[Ne,F("div",Oe,[U(D,{modelValue:e.goodsForm.SpecsAllowance,"onUpdate:modelValue":a[12]||(a[12]=a=>e.goodsForm.SpecsAllowance=a),type:"text"},null,8,["modelValue"])]),je,U(S,{type:"primary",round:"",class:"deep_dark",icon:"CirclePlus",onClick:e.addGoodsSpecs},{default:z((()=>[Ae])),_:1},8,["onClick"])]),F("div",Le,[(b(!0),C(O,null,j(e.goodsForm.GoodsSpecs,((a,o)=>(b(),C("span",{key:o,class:"spec_tag"},[U(q,{onClick:l=>e.removeGoodsSpecs(a,o)},{default:z((()=>[U(J)])),_:2},1032,["onClick"]),F("span",null,L(a.Specs),1),$(F("input",{"onUpdate:modelValue":e=>a.Specs=e,type:"text",placeholder:"商品規格",onInput:a=>e.spacTagChange(o)},null,40,Re),[[M,a.Specs]])])))),128))])])),_:1}),U(v,{label:"金額:",prop:"UnitPrice"},{default:z((()=>[F("div",$e,[U(D,{modelValue:e.goodsForm.UnitPrice,"onUpdate:modelValue":a[13]||(a[13]=a=>e.goodsForm.UnitPrice=a),type:"text",class:"col-1-3",placeholder:"商品單價"},null,8,["modelValue"])])])),_:1}),U(v,{label:"圖片上傳:",prop:"ImagesIdnet"},{default:z((()=>[F("div",Me,[F("label",Be,[F("span",Ee,[U(q,null,{default:z((()=>[U(X)])),_:1}),Ke]),F("input",{type:"file",onChange:a[14]||(a[14]=a=>e.selectFile(a))},null,32)]),F("span",Je,"選擇圖檔: "+L(e.state.imgFileName),1)]),F("div",qe,[F("div",Xe,[U(D,{modelValue:e.goodsForm.ImagesIdnet,"onUpdate:modelValue":a[15]||(a[15]=a=>e.goodsForm.ImagesIdnet=a),type:"text",placeholder:"圖片別名(Ident)"},null,8,["modelValue"])]),U(S,{type:"primary",class:"deep_dark",icon:"UploadFilled",onClick:e.handleUpload},{default:z((()=>[Ye])),_:1},8,["onClick"])]),F("div",He,[(b(!0),C(O,null,j(e.getcurrentImgs[e.goodsForm.ImagesIdnet],((a,o)=>(b(),C("div",{key:o,class:"img-preview__items"},[F("div",Qe,[F("img",{src:a.Url},null,8,We)]),F("div",Ze,[F("p",ea,"ID: "+L(a.ID),1),F("p",null,"Ident: "+L(a.Ident),1)]),U(q,{onClick:o=>e.handleRemoveImg(a)},{default:z((()=>[U(J)])),_:2},1032,["onClick"])])))),128))])])),_:1}),U(v,{label:"商品說明:",prop:"Description"},{default:z((()=>[U(D,{modelValue:e.goodsForm.Description,"onUpdate:modelValue":a[16]||(a[16]=a=>e.goodsForm.Description=a),type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"商品說明"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","onClose"]))],64)}]]);export{ta as default};
